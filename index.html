<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Video Enhancement - B.Tech Project</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .spinner {
        border: 4px solid rgba(59, 130, 246, 0.2);
        border-left-color: #3b82f6;
        border-radius: 50%;
        width: 2rem;
        height: 2rem;
        animation: spin 1s linear infinite;
      }
      @keyframes pulse-slow {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }
      .pulse-slow {
        animation: pulse-slow 2s ease-in-out infinite;
      }
      .progress-bar {
        transition: width 0.5s ease-in-out;
      }
      video {
        background: #000;
      }
    </style>
  </head>
  <body
    class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen font-sans antialiased"
  >
    <div class="container mx-auto max-w-6xl p-4 sm:p-8">
      <!-- Header -->
      <header class="bg-white p-8 rounded-xl shadow-xl mb-8">
        <div class="text-center">
          <h1 class="text-4xl font-bold text-gray-900 mb-2">
            üé¨ AI Video Enhancement
          </h1>
          <p class="text-gray-600 text-lg">
            Powered by Real-ESRGAN Deep Learning
          </p>
          <p class="text-sm text-gray-500 mt-1">
            B.Tech Final Year Project Prototype
          </p>
        </div>
      </header>

      <!-- Upload Section -->
      <section class="bg-white p-8 rounded-xl shadow-lg mb-8">
        <div class="flex items-center mb-6">
          <div
            class="w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold mr-4"
          >
            1
          </div>
          <h2 class="text-2xl font-semibold text-gray-800">Upload Video</h2>
        </div>

        <div class="mb-6">
          <p class="text-gray-600 mb-2">
            Select a video file to enhance using AI upscaling technology
          </p>
          <ul class="text-sm text-gray-500 list-disc list-inside space-y-1">
            <li>Supported formats: MP4, WebM, MOV, AVI</li>
            <li>Maximum file size: 100 MB</li>
            <li>
              Recommended: Short clips (5-30 seconds) for faster processing
            </li>
          </ul>
        </div>

        <form id="upload-form" class="space-y-4">
          <div
            class="border-2 border-dashed border-gray-300 rounded-lg p-6 hover:border-blue-400 transition-colors"
          >
            <input
              type="file"
              id="video-file"
              accept="video/mp4,video/webm,video/mov,video/avi"
              class="block w-full text-sm text-gray-600 file:mr-4 file:py-3 file:px-6 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700 file:cursor-pointer cursor-pointer file:transition-colors"
              required
            />
            <p class="text-xs text-gray-500 mt-2" id="file-info"></p>
          </div>

          <div class="flex flex-col sm:flex-row gap-4">
            <button
              type="submit"
              id="enhance-button"
              class="flex-1 px-8 py-4 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
            >
              üöÄ Enhance Video
            </button>
            <button
              type="button"
              id="reset-button"
              class="hidden px-6 py-4 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 focus:outline-none transition-all"
            >
              Reset
            </button>
          </div>
        </form>
      </section>

      <!-- Status Section -->
      <section
        id="status-section"
        class="hidden bg-white p-8 rounded-xl shadow-lg mb-8"
      >
        <div class="flex items-center mb-6">
          <div
            class="w-10 h-10 rounded-full bg-yellow-500 text-white flex items-center justify-center font-bold mr-4"
          >
            2
          </div>
          <h2 class="text-2xl font-semibold text-gray-800">Processing</h2>
        </div>

        <div class="space-y-4">
          <div class="flex items-center">
            <div class="spinner mr-4"></div>
            <div class="flex-1">
              <p id="status-text" class="font-medium text-gray-700 mb-2">
                Uploading video...
              </p>
              <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                <div
                  id="progress-bar"
                  class="progress-bar bg-blue-600 h-full rounded-full"
                  style="width: 0%"
                ></div>
              </div>
              <p id="progress-text" class="text-sm text-gray-500 mt-1">0%</p>
            </div>
          </div>

          <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
            <p class="text-sm text-blue-700">
              <strong>Note:</strong> Enhancement may take several minutes
              depending on video length and quality. Please keep this tab open.
            </p>
          </div>
        </div>
      </section>

      <!-- Error Section -->
      <section
        id="error-section"
        class="hidden bg-white p-8 rounded-xl shadow-lg mb-8"
      >
        <div class="flex items-center mb-4">
          <div
            class="w-10 h-10 rounded-full bg-red-500 text-white flex items-center justify-center font-bold mr-4"
          >
            ‚ö†
          </div>
          <h2 class="text-2xl font-semibold text-gray-800">Error</h2>
        </div>
        <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
          <p id="error-text" class="text-red-700"></p>
        </div>
      </section>

      <!-- Results Section -->
      <section
        id="results-section"
        class="hidden bg-white p-8 rounded-xl shadow-lg"
      >
        <div class="flex items-center mb-6">
          <div
            class="w-10 h-10 rounded-full bg-green-500 text-white flex items-center justify-center font-bold mr-4"
          >
            ‚úì
          </div>
          <h2 class="text-2xl font-semibold text-gray-800">Results</h2>
        </div>

        <div class="mb-6 bg-green-50 border-l-4 border-green-400 p-4 rounded">
          <p class="text-green-700 font-medium">
            ‚ú® Enhancement complete! Compare the results below.
          </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <!-- Original Video -->
          <div class="space-y-3">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-semibold text-gray-800">üìπ Original</h3>
              <span
                class="text-sm text-gray-500"
                id="original-resolution"
              ></span>
            </div>
            <div
              class="bg-gray-900 rounded-lg overflow-hidden aspect-video shadow-lg"
            >
              <video
                id="original-video"
                class="w-full h-full"
                controls
                muted
                playsinline
              >
                Your browser does not support the video tag.
              </video>
            </div>
          </div>

          <!-- Enhanced Video -->
          <div class="space-y-3">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-semibold text-gray-800">
                ‚ú® Enhanced (4K Upscaled)
              </h3>
              <span
                class="text-sm text-gray-500"
                id="enhanced-resolution"
              ></span>
            </div>
            <div
              class="bg-gray-900 rounded-lg overflow-hidden aspect-video shadow-lg"
            >
              <video
                id="enhanced-video"
                class="w-full h-full"
                controls
                muted
                playsinline
              >
                Your browser does not support the video tag.
              </video>
            </div>
          </div>
        </div>

        <!-- Sync Playback Controls -->
        <div class="bg-gray-50 p-4 rounded-lg mb-6">
          <div class="flex items-center justify-between flex-wrap gap-4">
            <div class="flex items-center gap-4">
              <button
                id="sync-play-btn"
                class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"
              >
                ‚ñ∂ Play Both
              </button>
              <button
                id="sync-pause-btn"
                class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium"
              >
                ‚è∏ Pause Both
              </button>
            </div>
            <label class="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                id="sync-checkbox"
                checked
                class="w-4 h-4 text-blue-600 rounded"
              />
              <span class="text-sm text-gray-700 font-medium"
                >Keep videos synced</span
              >
            </label>
          </div>
        </div>

        <!-- Download Button -->
        <div class="text-center">
          <a
            id="download-link"
            href="#"
            download="enhanced_video.mp4"
            class="inline-flex items-center px-8 py-4 bg-green-600 text-white font-semibold rounded-lg shadow-lg hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-300 transition-all duration-200 transform hover:scale-105"
          >
            <svg
              class="w-5 h-5 mr-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
              />
            </svg>
            Download Enhanced Video
          </a>
        </div>
      </section>

      <!-- Footer -->
      <footer class="text-center text-gray-600 text-sm mt-8 pb-8">
        <p>Powered by Real-ESRGAN | Deep Learning Video Enhancement</p>
        <p class="mt-1">B.Tech Final Year Project ¬© 2024</p>
      </footer>
    </div>

    <script>
      // DOM Elements
      const uploadForm = document.getElementById("upload-form");
      const videoFile = document.getElementById("video-file");
      const fileInfo = document.getElementById("file-info");
      const enhanceButton = document.getElementById("enhance-button");
      const resetButton = document.getElementById("reset-button");

      const statusSection = document.getElementById("status-section");
      const statusText = document.getElementById("status-text");
      const progressBar = document.getElementById("progress-bar");
      const progressText = document.getElementById("progress-text");

      const errorSection = document.getElementById("error-section");
      const errorText = document.getElementById("error-text");

      const resultsSection = document.getElementById("results-section");
      const originalVideo = document.getElementById("original-video");
      const enhancedVideo = document.getElementById("enhanced-video");
      const downloadLink = document.getElementById("download-link");
      const originalResolution = document.getElementById("original-resolution");
      const enhancedResolution = document.getElementById("enhanced-resolution");

      const syncPlayBtn = document.getElementById("sync-play-btn");
      const syncPauseBtn = document.getElementById("sync-pause-btn");
      const syncCheckbox = document.getElementById("sync-checkbox");

      // Configuration
      const API_URL = "http://127.0.0.1:5000";
      const MAX_FILE_MB = 100;
      const POLL_INTERVAL = 3000;

      let currentJobId = null;
      let pollingInterval = null;
      let originalFileBlob = null;

      // File input change handler
      videoFile.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          const sizeMB = (file.size / 1024 / 1024).toFixed(2);
          fileInfo.textContent = `Selected: ${file.name} (${sizeMB} MB)`;

          if (file.size > MAX_FILE_MB * 1024 * 1024) {
            fileInfo.textContent += ` - Warning: File exceeds ${MAX_FILE_MB}MB limit!`;
            fileInfo.classList.add("text-red-600");
          } else {
            fileInfo.classList.remove("text-red-600");
          }
        }
      });

      // Reset UI
      function resetUI() {
        enhanceButton.disabled = false;
        enhanceButton.textContent = "üöÄ Enhance Video";
        resetButton.classList.add("hidden");

        statusSection.classList.add("hidden");
        errorSection.classList.add("hidden");
        resultsSection.classList.add("hidden");

        progressBar.style.width = "0%";
        progressText.textContent = "0%";

        if (pollingInterval) {
          clearInterval(pollingInterval);
          pollingInterval = null;
        }

        currentJobId = null;
        originalFileBlob = null;
      }

      // Show status
      function showStatus(message, progress = 0) {
        statusSection.classList.remove("hidden");
        errorSection.classList.add("hidden");
        statusText.textContent = message;
        progressBar.style.width = `${progress}%`;
        progressText.textContent = `${Math.round(progress)}%`;
      }

      // Show error
      function showError(message) {
        errorSection.classList.remove("hidden");
        statusSection.classList.add("hidden");
        errorText.textContent = message;
        enhanceButton.disabled = false;
        enhanceButton.textContent = "üöÄ Enhance Video";
        resetButton.classList.remove("hidden");
      }

      // Poll job status
      function pollJobStatus(jobId) {
        pollingInterval = setInterval(async () => {
          try {
            const response = await fetch(`${API_URL}/status/${jobId}`);

            if (!response.ok) {
              throw new Error("Failed to check status");
            }

            const data = await response.json();

            if (data.status === "complete") {
              clearInterval(pollingInterval);
              showResults(jobId, data.download_url);
            } else if (data.status === "failed") {
              clearInterval(pollingInterval);
              showError(`Enhancement failed: ${data.error || "Unknown error"}`);
            } else if (data.status === "processing") {
              const progress = Math.min(data.progress || 50, 95);
              showStatus("Processing video with AI enhancement...", progress);
            }
          } catch (err) {
            console.error("Polling error:", err);
          }
        }, POLL_INTERVAL);
      }

      // Show results
      function showResults(jobId, downloadUrl) {
        statusSection.classList.add("hidden");
        resultsSection.classList.remove("hidden");
        resetButton.classList.remove("hidden");

        // Set original video
        if (originalFileBlob) {
          originalVideo.src = URL.createObjectURL(originalFileBlob);
        }

        // Set enhanced video
        enhancedVideo.src = `${API_URL}${downloadUrl}`;

        // Set download link
        downloadLink.href = `${API_URL}${downloadUrl}`;

        // Load videos
        originalVideo.load();
        enhancedVideo.load();

        // Get video dimensions when loaded
        originalVideo.addEventListener("loadedmetadata", () => {
          originalResolution.textContent = `${originalVideo.videoWidth}√ó${originalVideo.videoHeight}`;
        });

        enhancedVideo.addEventListener("loadedmetadata", () => {
          enhancedResolution.textContent = `${enhancedVideo.videoWidth}√ó${enhancedVideo.videoHeight}`;
        });
      }

      // Sync video playback
      function setupVideoSync() {
        let isSyncing = false;

        syncPlayBtn.addEventListener("click", () => {
          originalVideo.play();
          enhancedVideo.play();
        });

        syncPauseBtn.addEventListener("click", () => {
          originalVideo.pause();
          enhancedVideo.pause();
        });

        const syncVideos = (source, target) => {
          if (!syncCheckbox.checked || isSyncing) return;
          isSyncing = true;
          target.currentTime = source.currentTime;
          setTimeout(() => (isSyncing = false), 100);
        };

        originalVideo.addEventListener("play", () => {
          if (syncCheckbox.checked) enhancedVideo.play();
        });

        enhancedVideo.addEventListener("play", () => {
          if (syncCheckbox.checked) originalVideo.play();
        });

        originalVideo.addEventListener("pause", () => {
          if (syncCheckbox.checked) enhancedVideo.pause();
        });

        enhancedVideo.addEventListener("pause", () => {
          if (syncCheckbox.checked) originalVideo.pause();
        });

        originalVideo.addEventListener("seeked", () => {
          syncVideos(originalVideo, enhancedVideo);
        });

        enhancedVideo.addEventListener("seeked", () => {
          syncVideos(enhancedVideo, originalVideo);
        });
      }

      setupVideoSync();

      // Form submission
      uploadForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        resetUI();

        const file = videoFile.files[0];

        if (!file) {
          showError("Please select a video file");
          return;
        }

        if (file.size > MAX_FILE_MB * 1024 * 1024) {
          showError(`File too large. Maximum size: ${MAX_FILE_MB}MB`);
          return;
        }

        originalFileBlob = file;

        enhanceButton.disabled = true;
        enhanceButton.textContent = "Uploading...";
        showStatus("Uploading video...", 5);

        const formData = new FormData();
        formData.append("file", file);

        try {
          const response = await fetch(`${API_URL}/enhance`, {
            method: "POST",
            body: formData,
          });

          if (!response.ok) {
            const error = await response.json();
            throw new Error(error.error || "Upload failed");
          }

          const data = await response.json();
          currentJobId = data.job_id;

          showStatus("Video uploaded. Starting enhancement...", 15);
          enhanceButton.textContent = "Processing...";

          pollJobStatus(currentJobId);
        } catch (err) {
          showError(`Upload failed: ${err.message}`);
        }
      });

      // Reset button
      resetButton.addEventListener("click", () => {
        uploadForm.reset();
        fileInfo.textContent = "";
        resetUI();
      });
    </script>
  </body>
</html>
